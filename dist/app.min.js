!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).app=e()}(this,function(){"use strict";var r=function(t){void 0===t&&(t={}),this.name=t.name||"",this.color=t.color||"#000",this.yData=t.yData||[],this.active=t.active||!0,this.graph=t.graph||null};function s(t,e,i){return(t-e)/(i-e)}function h(t,e,i){return t+(e-t)*i}r.prototype.setActive=function(t){this.active=t},r.prototype.setChart=function(t){this.graph=t};var o=function(){this.range=[],this.domain=[]};o.prototype.setRange=function(t,e){return this.range=[t,e],this},o.prototype.setDomain=function(t,e){return this.domain=[t,e],this},o.prototype.get=function(t){var e=this.domain,i=e[0],a=e[1],n=this.range;return h(n[0],n[1],s(t,i,a))},o.prototype.invert=function(t){var e=this.domain,i=e[0],a=e[1],n=this.range;return h(i,a,s(t,n[0],n[1]))};var i=function(){this.xData=[],this.series=[],this.seriesIndex={},this.xScale=new o,this.yScale=new o};i.prototype.addSeries=function(t){t.setChart(this),this.series.push(t),this.seriesIndex[t.name]=t},i.prototype.setXData=function(t){this.xData=t};var a=window.document,n=function(t,e){this.root=t,this.el=a.createElement("div"),this.graph=e,this.render(),this.canvas=this.el.querySelector("canvas")};n.prototype.render=function(){var t=['<div class="cell container"><div class="graph"><canvas></canvas></div></div>',this.graph.series.map(this.renderSeries,this).join("")].join("");this.el.classList.add("chart"),this.el.innerHTML=t,this.root.appendChild(this.el)},n.prototype.renderSeries=function(t){return['<div class="cell">',"<label>",'<input type="checkbox" name="'+t.name+'" checked/>','<span class="icon" style="color:'+t.color+'"></span>','<span class="text">'+t.name+"</span>","</label>","</div>"].join("")};var c=window.devicePixelRatio||1,p=function(t,e){this.ctx=t.getContext("2d"),this.el=t.parentNode,this.navigation=e,this.graph=e.graph};p.prototype.clear=function(){this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()},p.prototype.scale=function(){var t=this.el.clientWidth,e=this.el.clientHeight,i=this.ctx.canvas;if(t!==this.width||e!==this.height){this.width=t,this.height=e,i.style.width=this.width+"px",i.style.height=this.height+"px",i.width=this.width*c,i.height=this.height*c,this.ctx.scale(c,c),this.ctx.translate(.5,.5);var a=.15*this.height;this.graph.yScale.setRange(this.height-a,0),this.navigation.yScale.setRange(this.height-2,this.height-a),this.graph.xScale.setRange(0,this.width-2),this.navigation.xScale.setRange(0,this.width-2),this.enqueue()}},p.prototype.redraw=function(){this.scale(),this.inQueue&&(this.clear(),this.draw())},p.prototype.enqueue=function(){this.inQueue=!0},p.prototype.dequeue=function(){this.inQueue=!1},p.prototype.draw=function(){this.drawNav(),this.drawSeries(),this.drawOverlay(),this.dequeue()},p.prototype.drawSeries=function(){for(var t,e,i=this.ctx,a=this.graph,n=this.navigation,s=n.offset,r=n.range,h=a.series,o=a.xData,c=a.xScale,p=a.yScale,l=n.xScale,d=n.yScale,u=0;u<h.length;u++){var v=h[u];if(v.active){var g=v.yData;o.length&&(i.beginPath(),i.moveTo(l.get(o[0]),d.get(g[0])));for(var f=1;f<o.length;f++){var y=o[f];i.lineTo(l.get(y),d.get(g[f])),null==t&&s<=y&&(t=f-1),null==e&&s+r<=y&&(e=f+1)}for(console.log(t,e),o.length&&i.moveTo(c.get(o[t]),p.get(g[t])),f=t+1;f<=e;f++)i.lineTo(c.get(o[f]),p.get(g[f]));i.strokeStyle=v.color,i.stroke()}}},p.prototype.drawNav=function(){var t=this.ctx,e=this.navigation,i=e.xScale,a=e.yScale,n=e.offset,s=e.range,r=i.get(n),h=a.range[0];t.strokeStyle="#ddeaf3",t.lineWidth=2,t.strokeRect(r,h,i.get(n+s)-r,a.range[1]-h)},p.prototype.drawOverlay=function(){};var l=function(t){this.graph=t,this.xScale=new o,this.yScale=new o;var e=t.xData,i=e[0],a=e[e.length-1],n=a-i;this.navigate(i+n/2,n/2),this.xScale.setDomain(i,a);var s=t.yScale.domain;this.yScale.setDomain(s[0],s[1])};l.prototype.navigate=function(t,e){this.offset=t,this.range=e,this.graph.xScale.setDomain(t,t+e),this.updateYExtremes()},l.prototype.updateYExtremes=function(){for(var t,e,i=this.graph.series,a=this.graph.xData,n=this.offset,s=n+this.range,r=0;r<i.length;r++){var h=i[r];if(h.active)for(var o=h.yData,c=0;c<a.length;c++){var p=a[c];if(n<=p&&p<=s){var l=o[c];e=e||l,l<(t=t||l)?t=l:e<l&&(e=l)}}}var d=.05*(e-t);this.graph.yScale.setDomain(t-d,e+d)};var d=function(t,e){this.graph=e,this.navigation=new l(e),this.view=new n(t,e),this.renderer=new p(this.view.canvas,this.navigation),this.subscribe()};d.prototype.subscribe=function(){this.view.el.addEventListener("change",this)},d.prototype.handleEvent=function(t){switch(t.type){case"change":return this.handleChange(t)}},d.prototype.handleChange=function(t){var e=t.target,i=e.name,a=this.graph.seriesIndex[i];a&&(a.setActive(e.checked),this.navigation.updateYExtremes(),this.renderer.enqueue())},d.prototype.redraw=function(t){this.renderer.redraw()};var t=function(t){this.element=t,this.charts=[],this.prevTime=0};t.prototype.addChart=function(t){this.charts.push(t)},t.prototype.load=function(){var t=this,e=new window.XMLHttpRequest;e.open("GET","./data/chart_data.json"),e.onload=function(){t.parse(JSON.parse(e.response))},e.send()},t.prototype.parse=function(t){var e=this;t.forEach(function(n){var s=new i;n.columns.forEach(function(t){var e=t[0],i=t.slice(1);if("x"===n.types[e])s.setXData(i);else{var a=new r({name:n.names[e],color:n.colors[e],yData:i});s.addSeries(a)}});var t=new d(e.element,s);e.addChart(t)})},t.prototype.digest=function(t){this.prevTime=this.prevTime||t;for(var e=0;e<this.charts.length;e++)this.charts[e].redraw(t-this.prevTime);this.prevTime=t};var u=window.requestAnimationFrame;var v=new t(document.getElementById("root"));return v.load(),function t(e){v.digest(e),u(t)}(),v});
