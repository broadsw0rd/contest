!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).app=e()}(this,function(){"use strict";var o=function(t){void 0===t&&(t={}),this.name=t.name||"",this.color=t.color||"#000",this.yData=t.yData||[],this.active=t.active||!0,this.graph=t.graph||null};function a(t,e,i){return(t-e)/(i-e)}function r(t,e,i){return t+(e-t)*i}o.prototype.setActive=function(t){this.active=t},o.prototype.setChart=function(t){this.graph=t};var e=function(){this.range=[],this.domain=[]};e.prototype.setRange=function(t,e){return this.range=[t,e],this},e.prototype.setDomain=function(t,e){return this.domain=[t,e],this},e.prototype.get=function(t){var e=this.domain,i=e[0],s=e[1],n=this.range;return r(n[0],n[1],a(t,i,s))},e.prototype.invert=function(t){var e=this.domain,i=e[0],s=e[1],n=this.range;return r(i,s,a(t,n[0],n[1]))};var i=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e};i.min=function(t,e){return t.mag()<e.mag()?t:e},i.max=function(t,e){return t.mag()>e.mag()?t:e},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},i.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},i.prototype.scale=function(t){return this.x*=t,this.y*=t,this},i.prototype.zero=function(){return this.x=0,this.y=0,this},i.prototype.mag=function(){return this.x*this.x+this.y*this.y},i.prototype.clone=function(){return new i(this.x,this.y)};var h=function(t,e){this.position=new i(t,e),this.previous=new i(t,e),this.acceleration=new i(0,0)};h.prototype.accelerate=function(t){this.acceleration.add(t)},h.prototype.simulate=function(t){this.acceleration.scale(t*t);var e=this.position.clone().scale(2).sub(this.previous).add(this.acceleration);this.previous=this.position,this.position=e,this.acceleration.zero()};var s=function(){this.xData=[],this.series=[],this.seriesIndex={},this.xScale=new e,this.yScale=new e,this.min=new h(0,0),this.max=new h(0,0)};s.prototype.addSeries=function(t){t.setChart(this),this.series.push(t),this.seriesIndex[t.name]=t},s.prototype.setXData=function(t){this.xData=t},s.prototype.simulate=function(t){var e=this.min,i=this.max;e.simulate(t),i.simulate(t),this.xScale.setDomain(e.position.x,i.position.x),this.yScale.setDomain(e.position.y,i.position.y)},s.prototype.getYExtremes=function(t,e){for(var i,s,n=this.series,a=this.xData,o=0;o<n.length;o++){var r=n[o];if(r.active)for(var h=r.yData,c=0;c<a.length;c++){var p=a[c];if(t<=p&&p<=e){var l=h[c];s=s||l,l<(i=i||l)?i=l:s<l&&(s=l)}}}var u=.1*(s-i);return[i-=u,s+=u]},s.prototype.findXIndex=function(t){for(var e=this.xData,i=0;i<e.length-1;i++){var s=e[i],n=e[i+1];if(s<=t&&t<=n)return t-s<n-t?i:i+1}return-1};var n=window.document;function c(t){return n.createElement(t)}function p(t,e){return t.querySelector(e)}function l(t,e){return t.querySelectorAll(e)}function u(t,e){t.appendChild(e)}function d(t,e){t.classList.add(e)}function v(t,e){t.innerHTML=e}function f(t,e,i){t.style[e]=i}function g(t,e){t.textContent=e}function y(t){f(t,"display","block")}function m(t){f(t,"display","none")}function x(t,e,i){t.addEventListener(e,i)}var w=function(t,e){this.root=t,this.el=c("div"),this.graph=e,this.init(),this.canvas=p(this.el,"canvas")};w.prototype.init=function(){var t=['<div class="cell container"><div class="graph"><canvas></canvas></div></div>',this.graph.series.map(this.initSeries,this).join("")].join("");d(this.el,"chart"),v(this.el,t),u(this.root,this.el)},w.prototype.initSeries=function(t){return['<div class="cell">',"<label>",'<input type="checkbox" name="'+t.name+'" checked/>','<span class="icon" style="color:'+t.color+'"></span>','<span class="text">'+t.name+"</span>","</label>","</div>"].join("")};var S=window.devicePixelRatio||1,D=function(t,e){this.ctx=t.getContext("2d"),this.el=t.parentNode,this.navigation=e,this.graph=e.graph,this.scale()};D.prototype.clear=function(){this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()},D.prototype.scale=function(){var t=this.el.clientWidth,e=this.el.clientHeight,i=this.ctx.canvas;if(t!==this.width||e!==this.height){this.width=t,this.height=e,i.style.width=this.width+"px",i.style.height=this.height+"px",i.width=this.width*S,i.height=this.height*S,this.ctx.scale(S,S),this.ctx.translate(.5,.5);var s=.15*this.height;this.graph.yScale.setRange(this.height-2,this.height-s),this.navigation.yScale.setRange(this.height-s,0),this.graph.xScale.setRange(0,this.width-2),this.navigation.xScale.setRange(0,this.width-2),this.enqueue()}},D.prototype.redraw=function(){this.inQueue&&(this.clear(),this.draw())},D.prototype.enqueue=function(){this.inQueue=!0},D.prototype.dequeue=function(){this.inQueue=!1},D.prototype.draw=function(){this.drawNav(),this.drawSeries(),this.drawOverlay(),this.dequeue()},D.prototype.drawSeries=function(){for(var t,e,i=this.ctx,s=this.graph,n=this.navigation,a=n.min.position.x,o=n.max.position.x,r=s.series,h=s.xData,c=s.xScale,p=s.yScale,l=n.xScale,u=n.yScale,d=0;d<r.length;d++){var v=r[d];if(v.active){var f=v.yData;h.length&&(i.beginPath(),i.moveTo(c.get(h[0]),p.get(f[0])));for(var g=1;g<h.length;g++){var y=h[g];i.lineTo(c.get(y),p.get(f[g])),null==t&&a<=y&&(t=g-1),null==e&&o<=y&&(e=g+1)}for(h.length&&i.moveTo(l.get(h[t]),u.get(f[t])),g=t+1;g<=e;g++)i.lineTo(l.get(h[g]),u.get(f[g]));i.strokeStyle=v.color,i.stroke()}}},D.prototype.drawNav=function(){var t=this.ctx,e=this.graph,i=e.xScale,s=e.yScale,n=e.min.position.x,a=e.max.position.x,o=i.get(n),r=i.get(a),h=s.range,c=h[0],p=h[1],l=c-p;t.strokeStyle="#ddeaf3",t.lineWidth=2,t.strokeRect(o,p+1,r-o,l-2),t.fillStyle="#ddeaf3",t.beginPath(),t.rect(o,p,6,l),t.rect(r-6,p,6,l),t.fill()},D.prototype.drawOverlay=function(){var t=this.ctx,e=this.graph,i=e.xScale,s=e.yScale,n=e.min.position.x,a=e.max.position.x,o=i.get(n),r=i.get(a),h=s.range,c=h[0],p=h[1],l=c-p;t.fillStyle="rgba(245, 249, 251, 0.8)",t.beginPath(),t.rect(0,p,o,l),t.rect(r,p,i.range[1]-r,l),t.fill()};var T=function(t){this.graph=t,this.xScale=new e,this.yScale=new e,this.setExtremes()};T.prototype.simulate=function(t){var e=this.graph,i=this.min,s=this.max;e.simulate(t),i.simulate(t),s.simulate(t),this.xScale.setDomain(i.position.x,s.position.x),this.yScale.setDomain(i.position.y,s.position.y)},T.prototype.setExtremes=function(){var t=this.graph.xData,e=t[0],i=t[t.length-1],s=this.graph.getYExtremes(e,i),n=s[0],a=s[1];this.graph.min=this.min=new h(e,n),this.graph.max=this.max=new h(i,a),this.simulate(0)};var b=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],M=["Jan","Fab","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var E=function(t,e){this.root=t,this.el=c("div"),this.navigation=e,this.idx=0,this.dots={},this.values={},this.items={},this.body=null,this.date=null,this.hide(),this.init()};E.prototype.init=function(){var t=this.navigation.graph.series,e=['<div class="body cell">','<div class="date"></div>','<div class="series">',t.map(this.initSeries,this).join(""),"</div>","</div>",t.map(this.initDot,this).join("")].join("");d(this.el,"tooltip"),v(this.el,e),u(this.root,this.el),this.collect(),this.render()},E.prototype.initSeries=function(t){return['<div class="item" id="'+t.name+'" style="color:'+t.color+'">','<div class="value" id="'+t.name+'"></div>','<div class="name">'+t.name+"</div>","</div>"].join("")},E.prototype.initDot=function(t){return'<div class="dot" id="'+t.name+'" style="color:'+t.color+'"></div>'},E.prototype.collect=function(){for(var t=l(this.el,".item"),e=l(this.el,".value"),i=l(this.el,".dot"),s=0;s<t.length;s++)this.items[t[s].id]=t[s],this.values[e[s].id]=e[s],this.dots[i[s].id]=i[s];this.body=p(this.el,".body"),this.date=p(this.el,".date")},E.prototype.render=function(){var e=this,t=this.navigation,i=t.graph,s=t.yScale,n=i.xData;i.series.forEach(function(t){e.renderSeries(t),e.renderDot(t)}),this.renderDate();var a=t.xScale,o=this.body.clientWidth,r=a.range,h=(r[0],r[1]),c=a.get(n[this.idx]),p=-12;h<c+o+p?p=h-c-o+8:c+p<-8&&(p=c-8),f(this.body,"transform","translate("+p+"px)"),f(this.el,"transform","translate("+c+"px)"),f(this.el,"height",s.range[0]-s.range[1]+"px")},E.prototype.renderDate=function(){var t,e;g(this.date,(t=this.navigation.graph.xData[this.idx],e=new Date(t),b[e.getDay()]+", "+M[e.getMonth()]+" "+e.getDate()))},E.prototype.renderSeries=function(t){var e=this.items[t.name];t.active?y(e):m(e),g(this.values[t.name],t.yData[this.idx].toLocaleString())},E.prototype.renderDot=function(t){var e=this.navigation.yScale,i=t.yData[this.idx],s=this.dots[t.name];t.active?y(s):m(s),f(s,"transform","translateY("+e.get(i)+"px)")},E.prototype.setIndex=function(t){this.idx=t,this.render()},E.prototype.show=function(t){var e=this.navigation,i=e.xScale.invert(t),s=e.graph.findXIndex(i);-1!==s&&(y(this.el),this.setIndex(s))},E.prototype.hide=function(){m(this.el)};var R=function(t,e){this.graph=e,this.navigation=new T(e),this.view=new w(t,e),this.renderer=new D(this.view.canvas,this.navigation),this.tooltip=new E(this.view.canvas.parentNode,this.navigation),this.offset=new i(0,0),this.subscribe(),this.pressed=!1,this.longTap=!1,this.offsetX=0,this.prevX=0,this.method=0};R.prototype.updateOffset=function(){var t=this.view.canvas.getBoundingClientRect();this.offset.x=t.left,this.offset.y=t.top},R.prototype.validate=function(t,e){var i=this.graph,s=i.xScale,n=i.yScale,a=s.range,o=a[0],r=a[1],h=n.range,c=h[0],p=h[1];return o<=t&&t<=r&&p<=e&&e<=c},R.prototype.prepare=function(t,e){return{x:t-=this.offset.x,y:e-=this.offset.y}},R.prototype.tap=function(t){this.view.canvas;var e=this.navigation,i=e.xScale,s=i.get(e.offset),n=i.get(e.offset+e.range);Math.abs(s-t)<10?this.method=1:Math.abs(n-t)<10?this.method=2:this.method=3},R.prototype.drag=function(t){var e=this.navigation,i=e.xScale,s=t-this.prevX,n=i.get(e.offset),a=i.invert(n+s),o=a-e.offset,r=e.range;1===this.method?(r=e.range-o,e.navigate(a,r)):2===this.method?(r=e.range+o,e.resize(r)):e.move(a),this.renderer.enqueue(),this.prevX=t},R.prototype.subscribe=function(){var t=this.view.canvas;x(this.view.el,"change",this),x(t,"mousedown",this),x(t,"mouseup",this),x(t,"touchstart",this),x(t,"touchend",this),x(t,"mousemove",this),x(t,"touchmove",this),x(t,"mouseleave",this)},R.prototype.handleEvent=function(t){switch(t.type){case"change":return this.handleChange(t);case"mousedown":return this.handleMousedown(t);case"touchstart":return this.handleTouchstart(t);case"mouseup":return this.handleMouseup(t);case"touchmove":return this.handleTouchmove(t);case"mousemove":return this.handleMousemove(t);case"touchend":case"touchcancel":return this.handleTouchend(t);case"mouseleave":return this.handleMouseleave(t)}},R.prototype.handleChange=function(t){var e=t.target,i=e.name,s=this.graph.seriesIndex[i];s&&(s.setActive(e.checked),this.navigation.updateYExtremes(),this.renderer.enqueue())},R.prototype.handleMousedown=function(t){var e=this.prepare(t.pageX,t.pageY),i=e.x,s=e.y;this.validate(i,s)&&(this.pressed=!0,this.tap(i))},R.prototype.handleMouseup=function(t){this.pressed=!1},R.prototype.handleMousemove=function(t){var e=this.prepare(t.pageX,t.pageY),i=e.x,s=e.y;this.validate(i,s)?(this.tooltip.hide(),this.pressed&&this.drag(i)):this.tooltip.show(i)},R.prototype.handleTouchstart=function(t){var e=this,i=t.targetTouches[0],s=this.prepare(i.pageX,i.pageY),n=s.x,a=s.y;this.validate(n,a)?(t.preventDefault(),this.pressed=!0,this.tap(n)):this.longTapTimeout=setTimeout(function(){e.longTap=!0,e.tooltip.show(n)},125)},R.prototype.handleTouchmove=function(t){t.targetTouches[0];var e=this.prepare(t.pageX,t.pageY),i=e.x,s=e.y;this.pressed&&this.validate(i,s)?(t.preventDefault(),this.drag(i)):this.longTap&&(t.preventDefault(),this.tooltip.show(i))},R.prototype.handleTouchend=function(t){t.preventDefault(),this.pressed=!1,this.longTap=!1,clearTimeout(this.longTapTimeout),this.tooltip.hide()},R.prototype.handleMouseleave=function(t){this.tooltip.hide()},R.prototype.redraw=function(t){this.navigation.simulate(t),this.renderer.redraw()};var t=function(t){this.element=t,this.charts=[],this.prevTime=0,this.subscribe()};t.prototype.addChart=function(t){this.charts.push(t)},t.prototype.load=function(){var t=this,e=new window.XMLHttpRequest;e.open("GET","./data/chart_data.json"),e.onload=function(){t.parse(JSON.parse(e.response))},e.send()},t.prototype.parse=function(t){var e=this;t.forEach(function(n){var a=new s;n.columns.forEach(function(t){var e=t[0],i=t.slice(1);if("x"===n.types[e])a.setXData(i);else{var s=new o({name:n.names[e],color:n.colors[e],yData:i});a.addSeries(s)}});var t=new R(e.element,a);e.addChart(t)}),this.handleScroll(),this.handleResize()},t.prototype.subscribe=function(){x(window.document.body,"scroll",this),x(window,"resize",this),x(window,"orientationchange",this)},t.prototype.handleEvent=function(t){switch(t.type){case"scroll":return this.handleScroll(t);case"resize":case"orientationchange":return this.handleResize(t)}},t.prototype.handleScroll=function(){for(var t=0;t<this.charts.length;t++)this.charts[t].updateOffset()},t.prototype.handleResize=function(){for(var t=0;t<this.charts.length;t++)this.charts[t].renderer.scale()},t.prototype.digest=function(t){this.prevTime=this.prevTime||t;for(var e=0;e<this.charts.length;e++)this.charts[e].redraw(t-this.prevTime);this.prevTime=t};var X=window.requestAnimationFrame;var q=new t(document.getElementById("root"));return q.load(),function t(e){q.digest(e),X(t)}(),q});
